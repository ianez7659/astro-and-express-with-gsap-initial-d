---

---

<dialog
  class="fixed inset-0 flex items-center justify-center bg-white z-50"
  style="display: none;"
>
  <div
    class="rounded-lg p-6 shadow-lg max-w-md text-center"
    style="background-image: linear-gradient(90deg, rgba(221, 221, 221, 0.5) 0%, rgba(115, 115, 115, 0.5) 100%)"
  >
    <h2 class="text-xl font-bold mb-4 text-gray-800">
      Your session is about to <span class="text-[#E20613]">expire</span>
    </h2>
    <p class="text-gray-700 mb-2">
      You will be logged out in <span
        id="countdown"
        class="font-bold text-[#E20613]"></span>
      seconds.
    </p>
    <p class="text-gray-600 mb-4">Do you want to stay signed in?</p>
    <div class="flex justify-center gap-4">
      <button
        id="continueBtn"
        class="bg-[#E20613] border-[2px] border-[#ffffff] text-[#ffffff] px-4 py-2 rounded-xl hover:bg-blue-700"
      >
        Yes, Keep me signed in
      </button>
      <button
        id="logoutBtn"
        class="bg-gray-200 text-gray-800 px-4 py-2 rounded-xl hover:bg-gray-300"
      >
        No, Sign me out
      </button>
    </div>
  </div>
</dialog>
<script>
  import { validateToken } from "../services/validateToken";
  import { sessionTimer, clearSessionTimers } from "../services/sessionTimer";
  import { removeLoginInfo } from "../services/sessionstorage";

  const dialog = document.querySelector<HTMLDialogElement>("dialog");
  const continueBtn = document.getElementById("continueBtn") as HTMLElement;
  const logoutBtn = document.getElementById("logoutBtn") as HTMLElement;

  if (dialog && continueBtn && logoutBtn) {
    dialog.style.display = "none";
    dialog.close();

    continueBtn.addEventListener("click", () => {
      clearSessionTimers();
      validateToken();
      sessionTimer();
    });

    logoutBtn.addEventListener("click", async () => {
      clearSessionTimers();
      const result = await removeLoginInfo();
      if (!result.success) {
        alert(result.error);
        return;
      } else if (result.success) {
        console.log("Logging out...");
        if (window.navigateWithFade) {
          window.navigateWithFade("/");
        } else {
          window.location.href = "/";
        }
      }
    });

    window.addEventListener("load", () => {
      sessionTimer();
    });
  } else {
    console.error("Dialog or buttons not found!");
  }
</script>
